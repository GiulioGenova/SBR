
ui <- dashboardPage(
  skin = "blue",
  dashboardHeader(title = "SBR App"),
  dashboardSidebar(
    sidebarMenu(
      menuItem("irrigAplant", tabName = "irrigApple", icon = icon("bar-chart-o")),
      menuItem("irrigAplant Demo", tabName = "irrigAppleDm", icon = icon("bar-chart-o")),
      menuItem("Data Browser", tabName = "Data", icon = icon("bar-chart-o")),
      menuItem("Station map", tabName = "map", icon = icon("info-circle")),
      menuItem("Tabelle ET", tabName = "table_wb", icon = icon("bar-chart-o"))

    )),
  dashboardBody(
    tags$head(
      tags$link(rel = "stylesheet", type = "text/css", href = "custom.css")
    ),
    # Boxes need to be put in a row (or column)
    tabItems(

      tabItem(tabName = "Data",

              fluidRow(
                box(width = 3,

                    selectInput("Station", label = h4(tags$b("Station")), #,multiple = T,
                                choices = sort(name_file$name),
                                selected = "Algund_2",multiple = T),

                    conditionalPanel(condition = "output.rightstatsens==false",
                                     textOutput( "mssgstatsenserror")),


                    conditionalPanel(condition = "output.rightstatsens",#br(),
                                     actionButton(label= "Grafik/Auswahl aktualisieren","refresh"))

                ),

                box(width = 3,

                    selectInput("selectedsensor", label = h4(tags$b("Parameter")),
                                choices = paste0(unique(sensor_file$MesswertBezDe),"_avg"),
                                selected = "Temperatur 2m_avg",multiple = T),# as.list(unique(sensor_file$MesswertBezDe))
                    #verbatimTextOutput("selectSensorlist")
                    conditionalPanel(
                      condition = "input.round != 'raw'",
                      checkboxGroupInput(inputId="doResamp",label = "Zeitaggregation",
                                         choices = list(Avg="_avg",
                                                        Min="_min",
                                                        Max="_max",
                                                        Sum="_sum"),
                                         selected = "_avg",
                                         inline=TRUE)
                    )
                    # checkboxInput("doAvg","Avg",TRUE),
                    # checkboxInput("doSum","Sum",TRUE),
                    # checkboxInput("doMin","Min",TRUE),
                    # checkboxInput("doMax","Max",TRUE)
                ),

                box(width = 3,
                    dateRangeInput(label = h4(tags$b("Datumsbereich auswählen")),
                                   inputId = "daterange",
                                   separator = " - ",
                                   min = "2013-01-01",
                                   start = Sys.Date()-3,
                                   end = Sys.Date()+1,
                                   language = "de"
                    ),

                    sliderInput('plotHeight', 'Höhe der Grafik (in Pixel)',
                                min = 150, max = 3500, value = 480)

                ),

                box(width = 3,

                    selectInput("round",label = h4("Zeitaggregation"),
                                choices = list(Rohwerte="raw",
                                               stündlich="hour",
                                               täglich="day",
                                               monatlich="month",
                                               jährlich="year"),
                                selected = "hour"),

                    downloadLink('downloadData', h4('Download'))

                )
                ,

                fluidRow(
                  uiOutput("plotAll")
                  # box(
                  #   #id="box_plot",
                  #   title = "Soil Air Precipitation Irrigation",solidHeader = TRUE,
                  #   collapsible = FALSE,status = "primary",
                  #   plotlyOutput("plotall")%>% withSpinner(), width = 12)#,height = "920px"
                  #   #plotOutput("plotall",height = "auto")%>% withSpinner(), width = 12)#,height = "920px"

                )
              )
      ),
      tabItem(tabName = "map",
              fluidRow(
                box(
                  id="box2",
                  width = 12,collapsible = T,#height="80vh",
                  htmlOutput("map2"))

              )
      ),
      tabItem(tabName = "irrigApple",
              fluidRow(
                conditionalPanel(id = "controlsParent",
                                 condition="($('html').hasClass('shiny-busy'))",
                                 absolutePanel(id = "controls", class = "panel panel-default", fixed = TRUE,
                                               draggable = TRUE,top = 25, left = "auto", right = 0, bottom = "auto",
                                               img(src="annaffiatoio.gif",#spinner3.gif
                                                   width = "200px", height = "200px")
                                 )
                ),
                column(
                  width = 12,
                  # box(
                  #   width=12,
                  #   #plotOutput("irrigAdvise")%>% withSpinner()
                  #   timevisOutput("irrigAdvise")
                  # )
                  box(
                    width = 6,
                    p(h4("Geben Sie unten den letzten Tag an, den Sie bewässert haben.") ),
                    p(h4("Klicken Sie dann in der Karte auf Ihr Feld, um einen Bewässerungshinweis zu erhalten")),
                    dateInput("date",label = "Letzter Bewässerungszeitpunkt",
                              min = Sys.Date()-90,max = Sys.Date(),language = "de")#,

                    # irrig used to be based on two categories ("normal" and "light")
                    # and computed based on the TAW. the client asked for a numerical
                    # input (in mm)

                    # radioButtons("irr", "Irrigation type:",
                    #              c("Normal" = "norm",
                    #                "Light" = "light"),
                    #              selected = "norm",
                    #              inline = T),
                  ),
                  box(

                    fluidRow(
                      column(
                        width = 4,
                        numericInput("irr", "Bewässerte Menge [mm]:",
                                     value = 50,min = 0,max=300)

                        # numericInput("slope", "Steigung [%]:",
                        #              0,min = 0,max = 35
                        # ),
                      ),
                      column(width = 4,
                             radioButtons("soil", "Bodenart:",
                                          c("Schwer" = "heavy",
                                            "Mittel"= "medium",
                                            "Leicht" = "light"),
                                          selected = "medium",
                                          inline = F)
                      )
                      ,
                      column(width = 4,
                             radioButtons("dataSource", "Datenquelle:",
                                          c(
                                            "Beratungsring"= "sbr",
                                            "Provinz" = "prov",
                                            "Beide" = "beide"),
                                          selected = "sbr",
                                          inline = F)
                      )
                    )
                  ),
                  box(
                    width = 12,
                    conditionalPanel(condition="output.nodata",
                                     p(h3("no data") )
                    ),
                    conditionalPanel(condition="output.nodata==false",
                                     timevisOutput("irrigAdvise")
                    )
                  )
                  ,
                  box(
                    id="box1",
                    width = 12,
                    leafletOutput("mapIrrig")#,
                    # absolutePanel(id = "controls", class = "panel panel-default", fixed = FALSE,
                    #               draggable = TRUE, top = 5, left = "auto", right = 80, bottom = "auto",
                    #               width = "80%", height = "auto",
                    #
                    #               timevisOutput("irrigAdvise")
                    #
                    # )
                  )
                )


              )
      ),
      tabItem(tabName = "irrigAppleDm",
              fluidRow(
                conditionalPanel(id = "controlsParent",
                                 condition="($('html').hasClass('shiny-busy'))",
                                 absolutePanel(id = "controls", class = "panel panel-default", fixed = TRUE,
                                               draggable = TRUE,top = 25, left = "auto", right = 0, bottom = "auto",
                                               img(src="annaffiatoio.gif",#spinner3.gif
                                                   width = "200px", height = "200px")
                                 )
                ),
                column(width = 12,
                       box(
                         width = 6,
                         p(h4("Geben Sie unten den letzten Tag an, den Sie bewässert haben.") ),
                         p(h4("Klicken Sie dann in der Karte auf Ihr Feld, um einen Bewässerungshinweis zu erhalten")),

                         # dateInput("dateDm",label = "Letzter Bewässerungszeitpunkt",
                         #           min = Sys.Date()-365,max = Sys.Date(),language = "de"),
                         # dateInput("today",label = "Welcher Tag ist heute?",
                         #           min = Sys.Date()-364,max = Sys.Date(),language = "de"),

                         # radioButtons("irrDm", "Irrigation type:",
                         #              c("Normal" = "norm",
                         #                "Light" = "light"),
                         #              selected = "norm",
                         #              inline = T),


                         div(style=" width: 100%;",
                             div(style="display: inline-block;vertical-align:top; width: 40%;",
                                 dateInput("dateDm",label = "Letzter Bewässerungszeitpunkt",
                                           min = Sys.Date()-365,max = Sys.Date(),language = "de")
                             ),
                             div(style="display: inline-block;vertical-align:top; width: 40%;",
                                 dateInput("today",label = "Welcher Tag ist heute?",
                                           min = Sys.Date()-364,max = Sys.Date(),language = "de")
                             )
                         )

                       )
                       ,
                       box(
                         fluidRow(
                           column(
                             width=4,
                             numericInput("irrDm", "Bewässerte Menge [mm]:",
                                          value = 50,min = 0,max=300)
                           ),
                           column(
                             width=4,
                             radioButtons("soilDm", "Bodenart:",
                                          c("Schwer" = "heavy",
                                            "Mittel"= "medium",
                                            "Leicht" = "light"),
                                          selected = "medium",
                                          inline = F)
                           ),
                           column(
                             width = 4,
                             radioButtons("dataSourceDm", "Datenquelle:",
                                          c(
                                            "Beratungsring"= "sbr",
                                            "Provinz" = "prov",
                                            "Beide" = "beide"),
                                          selected = "sbr",
                                          inline = F)
                           )
                         )
                       ),

                       box(
                         width=12,
                         #plotOutput("irrigAdviseDm")%>% withSpinner()
                         conditionalPanel(condition="output.nodataDm",
                                          p(h3("no data") )
                         ),
                         conditionalPanel(condition="output.nodataDm==false",
                                          timevisOutput("irrigAdviseDm")
                         )
                       )
                       ,
                       box(
                         id="boxDm",
                         width = 12,
                         leafletOutput("mapIrrigDm")#%>% withSpinner()
                       )


                )
              )

      ),
      tabItem(tabName = "table_wb",
              fluidRow(
                conditionalPanel(id = "controlsParent",
                                 condition="($('html').hasClass('shiny-busy'))",
                                 absolutePanel(id = "controls", class = "panel panel-default", fixed = TRUE,
                                               draggable = TRUE,top = 25, left = "auto", right = 0, bottom = "auto",
                                               img(src="annaffiatoio.gif",#spinner3.gif
                                                   width = "200px", height = "200px")
                                 )
                ),
                box(
                  h3("Dieses Tool erstellt eine Tabelle mit Niederschlag und Verdunstung"),
                  fluidRow(

                    column(width=6,
                           selectInput(inputId = "wbtabMt",label = "Wähle einen Monat",
                                       choices = c(3,4,5,6,7,8,9),selected =

                                         if(month(Sys.Date())-1 <= 9 & month(Sys.Date())-1 >= 3){

                                           month(Sys.Date())-1

                                         }else{

                                           9

                                         }

                           )
                    ),
                    column(width=6,
                           selectInput(inputId = "wbtabYr",label = "Wähle ein Jahr",
                                       choices = seq(2014, 2035, by=1),selected =

                                         if(month(Sys.Date())-1 <= 12 & month(Sys.Date())-1 >= 3){

                                           year(Sys.Date())

                                         }else{

                                           year(Sys.Date())-1

                                         }

                           )
                    )
                  )
                  ,

                  selectInput("stationsTableWB",label = "Wählen Sie einen oder mehrere Sender aus",
                              choices = station_list,
                              selected = c(3,7,9,12,14,17,37,39,#30,52,103,105,169,
                                           70,84,106,125,171, 172,174,176),
                              multiple = T
                  ),
                  actionButton('buildTable_wb', h4('Erstellen Sie die Tabelle')),
                  conditionalPanel(condition = "output.tablebuilt",
                                   downloadButton('downloadTable_wb', h4('Laden Sie die Tabelle herunter'))
                  )

                )
              )
      )
    )
  )
)
